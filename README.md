# éšå½¢æ–‡æ¡£æ°´å°å·¥å…·

ä¸€ä¸ªå®‰å…¨ã€é«˜æ•ˆçš„éšå½¢æ–‡æ¡£æ°´å°è§£å†³æ–¹æ¡ˆï¼Œå¯ä¸ºå„ç±»æ–‡æ¡£æ·»åŠ å®Œå…¨ä¸å¯è§çš„æ•°å­—æ°´å°ï¼ŒåŒæ—¶æ”¯æŒæ°´å°æå–å’ŒéªŒè¯ã€‚åŸºäºGoè¯­è¨€å¼€å‘ï¼Œæ”¯æŒwebå’Œcliä¸¤ç§æ–¹å¼ä½¿ç”¨ï¼Œæ°´å°é‡‡ç”¨éšå†™æŠ€æœ¯ï¼Œç¡®ä¿æ°´å°å®Œå…¨éšå½¢ä¸”ä¸å½±å“åŸå§‹æ–‡æ¡£çš„é˜…è¯»ä½“éªŒå’Œè§†è§‰æ•ˆæœã€‚

<img src="https://github.com/Ed1s0nZ/watermark-tool/blob/main/image/%E7%95%8C%E9%9D%A2.png" width="800px">  

## æ›´æ–°æ—¶é—´çº¿
- 2025.06.08
  1. ğŸŒŸåœ¨æå–æ°´å°æ—¶ï¼Œå¢åŠ äº†â€˜æ˜¾ç¤ºæ°´å°æ·»åŠ æ—¶é—´â€™çš„åŠŸèƒ½ï¼›
  2. è§£å†³äº†ä¸€ä¸ªå‰ç«¯å¤é€‰æ¡†çš„bugï¼Œè¯¥bugä¼šå¯¼è‡´é€‰æ‹©â€˜æ˜¾ç¤ºæ°´å°æ·»åŠ æ—¶é—´â€™æ— æ³•ç”Ÿæ•ˆã€‚

## å¿«é€Ÿå¼€å§‹
```bash
# å¿«é€Ÿå®‰è£…å’Œå¯åŠ¨
git clone https://github.com/Ed1s0nZ/watermark-tool.git
cd watermark-tool
go build -o server ./cmd/server
./server
# ç„¶åè®¿é—® http://localhost:8080
```


## Webå±•ç¤º
### æ·»åŠ éšæ°´å°   
<img src="https://github.com/Ed1s0nZ/watermark-tool/blob/main/image/%E6%B7%BB%E5%8A%A0%E9%9A%90%E6%B0%B4%E5%8D%B0.png" width="800px">  


### æå–éšæ°´å°
<img src="https://github.com/Ed1s0nZ/watermark-tool/blob/main/image/%E6%8F%90%E5%8F%96%E9%9A%90%E6%B0%B4%E5%8D%B0.png" width="800px">  

## ä¸»è¦ç‰¹æ€§

- **å®Œå…¨éšè”½**ï¼šæ°´å°å®Œå…¨éšå½¢ï¼Œå¯¹æ–‡æ¡£å†…å®¹å’Œå¤–è§‚é›¶å½±å“ï¼Œè‚‰çœ¼æ— æ³•è¯†åˆ«
- **å®‰å…¨åŠ å¯†**ï¼šä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•ç¡®ä¿æ°´å°ä¿¡æ¯å®‰å…¨ä¸è¢«ç¯¡æ”¹
- **é˜²ç¯¡æ”¹è®¾è®¡**ï¼šç‹¬ç‰¹æ ¡éªŒæœºåˆ¶ç¡®ä¿æ°´å°ä¸è¢«éæ³•ä¿®æ”¹ï¼Œå¢å¼ºå®‰å…¨æ€§
- **å¤šæ ¼å¼æ”¯æŒ**ï¼šå…¼å®¹å¤šç§å¸¸ç”¨æ–‡ä»¶æ ¼å¼ï¼ˆPDFã€DOCXã€XLSXã€PPTXã€JPGã€PNGç­‰ï¼‰
- **ç®€æ´ç•Œé¢**ï¼šç›´è§‚æ˜“ç”¨çš„Webç•Œé¢ï¼Œæ“ä½œç®€å•å¿«æ·
- **APIæ”¯æŒ**ï¼šæä¾›å®Œæ•´REST APIï¼Œä¾¿äºé›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ
- **é«˜æ€§èƒ½å¤„ç†**ï¼šä¼˜åŒ–çš„å¤„ç†æµç¨‹ï¼Œå¿«é€Ÿå¤„ç†å„ç±»æ–‡æ¡£ï¼Œæ”¯æŒå¹¶å‘è¯·æ±‚

## æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

| æ–‡ä»¶ç±»å‹ | æ°´å°æ·»åŠ  | æ°´å°æå–  | å¤‡æ³¨ |
|---------|:-------:|:-------:|------|
| PDF     | âœ…      | âœ…      | å…ƒæ•°æ®éšå†™æŠ€æœ¯ï¼Œæ–‡æ¡£å¤–è§‚æ— å˜åŒ– |
| DOCX    | âœ…      | âœ…      | åœ¨æ–‡æ¡£å±æ€§å’Œå†…å®¹ä¸­æ·»åŠ éšè—æ ‡è®° |
| XLSX    | âœ…      | âœ…      | åœ¨ç”µå­è¡¨æ ¼å†…éƒ¨XMLä¸­æ·»åŠ åŠ å¯†æ ‡è®° |
| PPTX    | âœ…      | âœ…      | åœ¨å¹»ç¯ç‰‡XMLä¸­æ·»åŠ ä¸å¯è§æ³¨é‡Š |
| JPG     | âœ…      | âœ…      | ä½¿ç”¨EXIFæ³¨é‡Šå’ŒåŠ å¯†æ–¹å¼æ·»åŠ æ°´å° |
| PNG     | âœ…      | âœ…      | ä½¿ç”¨æ–‡æœ¬å—æ·»åŠ éšè—æ°´å° |
| RTF     | âœ…      | âœ…      | ä½¿ç”¨ç‰¹æ®Šå­—æ®µéšè—æ°´å°ä¿¡æ¯ |
| ODT     | âœ…      | âœ…      | åœ¨æ–‡æ¡£XMLç»“æ„ä¸­æ·»åŠ éšè—æ ‡è®° |

## å¿«é€Ÿå¼€å§‹

### å®‰è£…è¦æ±‚

- Go 1.18+ï¼ˆæ¨èä½¿ç”¨Go 1.20æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
- ä¸»è¦ä¾èµ–ï¼š
  - github.com/gin-gonic/gin
  - github.com/gin-contrib/cors
  - github.com/google/uuid

### å®‰è£…æ­¥éª¤

1. å…‹éš†ä»“åº“
   ```bash
   git clone https://github.com/Ed1s0nZ/watermark-tool.git
   cd watermark-tool
   ```

2. å®‰è£…ä¾èµ–
   ```bash
   go mod tidy
   ```

3. æ„å»ºé¡¹ç›®
   ```bash
   go build -o server ./cmd/server
   ```
   
4. è¿è¡ŒæœåŠ¡
   ```bash
   ./server
   ```

5. è®¿é—®Webç•Œé¢
   ```
   http://localhost:8080
   ```

## ä½¿ç”¨æŒ‡å—

### Webç•Œé¢ä½¿ç”¨

1. è®¿é—® http://localhost:8080
2. é€‰æ‹©"æ·»åŠ éšæ°´å°"æˆ–"æå–éšæ°´å°"åŠŸèƒ½
3. ä¸Šä¼ æ–‡ä»¶å¹¶è¾“å…¥éšæ°´å°æ–‡æœ¬ï¼ˆæ·»åŠ æ°´å°æ—¶ï¼‰
4. ç­‰å¾…å¤„ç†å®Œæˆåä¸‹è½½æ–‡ä»¶æˆ–æŸ¥çœ‹æå–ç»“æœ

### å‘½ä»¤è¡Œ(CLI)ä½¿ç”¨

é™¤äº†Webç•Œé¢å¤–ï¼Œæœ¬å·¥å…·è¿˜æä¾›å‘½ä»¤è¡Œç•Œé¢(CLI)ï¼Œæ–¹ä¾¿åœ¨è„šæœ¬ä¸­ä½¿ç”¨æˆ–æ‰¹å¤„ç†æ–‡ä»¶ã€‚

#### æ„å»ºCLIå·¥å…·

```bash
# æ„å»ºCLIå·¥å…·
go build -o cli ./cmd/cli
```

æ„å»ºå®Œæˆåï¼ŒCLIå·¥å…·ä½äº `./cli`ã€‚

#### CLIå‘½ä»¤

1. æ·»åŠ æ°´å°

```bash
./cli add [è¾“å…¥æ–‡ä»¶] [è¾“å‡ºæ–‡ä»¶] [æ°´å°æ–‡æœ¬]

# ç¤ºä¾‹
./cli add æ–‡æ¡£.pdf å¸¦æ°´å°.pdf "æœºå¯†æ–‡ä»¶-è¯·å‹¿å¤–ä¼ "
```

2. æå–æ°´å°

```bash
./cli extract [è¾“å…¥æ–‡ä»¶]

# ç¤ºä¾‹
./cli extract å¸¦æ°´å°.pdf
```

3. æŸ¥çœ‹æ”¯æŒçš„æ–‡ä»¶ç±»å‹

```bash
./cli types
```

### APIæ¥å£ä½¿ç”¨

#### æ·»åŠ éšæ°´å°

```http
POST /api/add-watermark
Content-Type: multipart/form-data

å‚æ•°:
- file: æ–‡ä»¶æ•°æ®
- watermark: éšæ°´å°æ–‡æœ¬
```

ç¤ºä¾‹è¯·æ±‚ï¼š

```bash
curl -X POST -F "file=@æ–‡æ¡£.pdf" -F "watermark=æœºå¯†æ–‡ä»¶" \
     http://localhost:8080/api/add-watermark -o å¸¦æ°´å°æ–‡æ¡£.pdf
```

#### æå–éšæ°´å°

```http
POST /api/extract-watermark
Content-Type: multipart/form-data

å‚æ•°:
- file: æ–‡ä»¶æ•°æ®
```

ç¤ºä¾‹è¯·æ±‚ï¼š

```bash
curl -X POST -F "file=@å¸¦æ°´å°æ–‡æ¡£.pdf" \
     http://localhost:8080/api/extract-watermark
```

#### è·å–æ”¯æŒçš„æ–‡ä»¶ç±»å‹

```http
GET /api/supported-types
```

ç¤ºä¾‹å“åº”ï¼š

```json
{
  "supported_types": ["pdf", "docx", "xlsx", "pptx", "jpg", "png", "rtf", "odt"]
}
```

### ç¼–ç¨‹ç¤ºä¾‹

ä»¥ä¸‹æ˜¯é€šè¿‡Goä»£ç ä½¿ç”¨è¯¥å·¥å…·çš„ç®€å•ç¤ºä¾‹ï¼š

```go
package main

import (
	"bytes"
	"fmt"
	"io"
	"mime/multipart"
	"net/http"
	"os"
	"path/filepath"
)

func main() {
	// æ·»åŠ éšæ°´å°ç¤ºä¾‹
	filePath := "example.pdf"
	watermarkText := "æœºå¯†æ–‡æ¡£-è¯·å‹¿å¤–ä¼ "
	
	err := addWatermark(filePath, watermarkText)
	if err != nil {
		fmt.Printf("æ·»åŠ éšæ°´å°å¤±è´¥: %v\n", err)
		return
	}
	
	// æå–éšæ°´å°ç¤ºä¾‹
	watermarkedFile := "example_watermarked.pdf"
	text, err := extractWatermark(watermarkedFile)
	if err != nil {
		fmt.Printf("æå–éšæ°´å°å¤±è´¥: %v\n", err)
		return
	}
	
	fmt.Printf("æå–çš„éšæ°´å°å†…å®¹: %s\n", text)
}

// æ·»åŠ éšæ°´å°
func addWatermark(filePath, watermarkText string) error {
	// åˆ›å»ºmultipartè¡¨å•
	var buf bytes.Buffer
	writer := multipart.NewWriter(&buf)
	
	// æ·»åŠ æ–‡ä»¶
	file, err := os.Open(filePath)
	if err != nil {
		return err
	}
	defer file.Close()
	
	part, err := writer.CreateFormFile("file", filepath.Base(filePath))
	if err != nil {
		return err
	}
	_, err = io.Copy(part, file)
	if err != nil {
		return err
	}
	
	// æ·»åŠ æ°´å°æ–‡æœ¬
	err = writer.WriteField("watermark", watermarkText)
	if err != nil {
		return err
	}
	
	writer.Close()
	
	// å‘é€è¯·æ±‚
	resp, err := http.Post("http://localhost:8080/api/add-watermark", writer.FormDataContentType(), &buf)
	if err != nil {
		return err
	}
	defer resp.Body.Close()
	
	// æ£€æŸ¥å“åº”
	if resp.StatusCode != http.StatusOK {
		return fmt.Errorf("æœåŠ¡å™¨è¿”å›é”™è¯¯: %s", resp.Status)
	}
	
	// ä¿å­˜ç»“æœ
	output, err := os.Create(filePath[:len(filePath)-4] + "_watermarked" + filepath.Ext(filePath))
	if err != nil {
		return err
	}
	defer output.Close()
	
	_, err = io.Copy(output, resp.Body)
	return err
}

// æå–éšæ°´å°
func extractWatermark(filePath string) (string, error) {
	// åˆ›å»ºmultipartè¡¨å•
	var buf bytes.Buffer
	writer := multipart.NewWriter(&buf)
	
	// æ·»åŠ æ–‡ä»¶
	file, err := os.Open(filePath)
	if err != nil {
		return "", err
	}
	defer file.Close()
	
	part, err := writer.CreateFormFile("file", filepath.Base(filePath))
	if err != nil {
		return "", err
	}
	_, err = io.Copy(part, file)
	if err != nil {
		return "", err
	}
	
	writer.Close()
	
	// å‘é€è¯·æ±‚
	resp, err := http.Post("http://localhost:8080/api/extract-watermark", writer.FormDataContentType(), &buf)
	if err != nil {
		return "", err
	}
	defer resp.Body.Close()
	
	// æ£€æŸ¥å“åº”
	if resp.StatusCode != http.StatusOK {
		return "", fmt.Errorf("æœåŠ¡å™¨è¿”å›é”™è¯¯: %s", resp.Status)
	}
	
	// è¯»å–ç»“æœ
	var result struct {
		Watermark string `json:"watermark"`
		Error     string `json:"error"`
	}
	
	body, err := io.ReadAll(resp.Body)
	if err != nil {
		return "", err
	}
	
	return string(body), nil
}
```

## éšæ°´å°æŠ€æœ¯åŸç†

æœ¬å·¥å…·é‡‡ç”¨å¤šç§éšå†™æŠ€æœ¯å®ç°ä¸å¯è§æ°´å°ï¼š

1. **å…ƒæ•°æ®åµŒå…¥**ï¼šåœ¨æ–‡ä»¶å…ƒæ•°æ®ä¸­åµŒå…¥åŠ å¯†æ°´å°ä¿¡æ¯
2. **å†…å®¹éšå†™**ï¼šåœ¨æ–‡æ¡£å†…å®¹çš„ä¸å¯è§éƒ¨åˆ†åµŒå…¥ç¼–ç ä¿¡æ¯
3. **ç»“æ„éšè—**ï¼šåˆ©ç”¨æ–‡ä»¶æ ¼å¼ç»“æ„ç‰¹æ€§éšè—æ°´å°æ•°æ®
4. **åŠ å¯†ä¿æŠ¤**ï¼šä½¿ç”¨AES-GCMç­‰é«˜å¼ºåº¦åŠ å¯†ç®—æ³•ä¿æŠ¤æ°´å°å†…å®¹
5. **æ ¡éªŒæœºåˆ¶**ï¼šæ·»åŠ æ ¡éªŒå’Œå’Œæ—¶é—´æˆ³ç¡®ä¿æ°´å°å®Œæ•´æ€§

## å®‰å…¨ç‰¹æ€§

è¯¥å·¥å…·é‡‡ç”¨å¤šå±‚æ¬¡å®‰å…¨è®¾è®¡ï¼Œç¡®ä¿æ°´å°ä¿¡æ¯çš„å®‰å…¨æ€§ï¼š

1. **æ•°æ®åŠ å¯†**ï¼šæ‰€æœ‰æ°´å°å†…å®¹ä½¿ç”¨AES-256ç®—æ³•åŠ å¯†å­˜å‚¨
2. **å¯†é’¥ç®¡ç†**ï¼šç³»ç»Ÿä½¿ç”¨å®‰å…¨çš„å¯†é’¥ç”Ÿæˆå’Œç®¡ç†æœºåˆ¶
3. **å®Œæ•´æ€§éªŒè¯**ï¼šä½¿ç”¨æ ¡éªŒå’Œæœºåˆ¶éªŒè¯æ°´å°å®Œæ•´æ€§ï¼Œé˜²æ­¢ç¯¡æ”¹
4. **æ—¶é—´æˆ³**ï¼šæ¯ä¸ªæ°´å°éƒ½åŒ…å«æ—¶é—´æˆ³ä¿¡æ¯ï¼Œå¯ç”¨äºè¿½è¸ªæº¯æº
5. **æŠ—æå–è®¾è®¡**ï¼šå³ä½¿çŸ¥é“æ°´å°å­˜åœ¨ï¼Œæ²¡æœ‰æ­£ç¡®å·¥å…·å’Œå¯†é’¥ä¹Ÿæ— æ³•æå–
6. **é”™è¯¯å¤„ç†**ï¼šå®‰å…¨çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œä¸ä¼šæ³„éœ²æ•æ„Ÿä¿¡æ¯

ä¸ºæé«˜å®‰å…¨æ€§ï¼Œå»ºè®®ï¼š
- å®šæœŸæ›´æ¢ç³»ç»Ÿå¯†é’¥
- é™åˆ¶APIè®¿é—®æƒé™
- å¯ç”¨HTTPSåŠ å¯†ä¼ è¾“
- è®°å½•æ‰€æœ‰æ°´å°æ“ä½œæ—¥å¿—

## æ³¨æ„äº‹é¡¹

1. è™½ç„¶æ°´å°å®Œå…¨éšå½¢ï¼Œä½†åœ¨ç‰¹å®šæƒ…å†µä¸‹å¯èƒ½è¢«ä¸“ä¸šå·¥å…·æ£€æµ‹åˆ°
2. æ°´å°å®‰å…¨æ€§ä¾èµ–äºå¯†é’¥çš„ä¿å¯†æ€§ï¼Œè¯·å¦¥å–„ä¿ç®¡ç³»ç»Ÿå¯†é’¥
3. ä¸åŒæ–‡ä»¶æ ¼å¼çš„æ°´å°å®ç°æ–¹å¼ä¸åŒï¼Œå®‰å…¨çº§åˆ«å¯èƒ½æœ‰å·®å¼‚
4. å¤„ç†å¤§å‹æ–‡ä»¶æ—¶å¯èƒ½éœ€è¦è°ƒæ•´æœåŠ¡å™¨é…ç½®ï¼Œå¢åŠ è¶…æ—¶æ—¶é—´

## æœªæ¥è®¡åˆ’

- [ ] æ”¯æŒæ›´å¤šæ–‡ä»¶æ ¼å¼ï¼ˆåŒ…æ‹¬éŸ³é¢‘å’Œè§†é¢‘æ ¼å¼ï¼‰
- [ ] æ·»åŠ æ‰¹é‡å¤„ç†åŠŸèƒ½
- [ ] å®ç°æ°´å°æ¨¡æ¿å’Œæƒé™ç®¡ç†
- [ ] æä¾›æ›´é«˜çº§çš„æ°´å°ç­–ç•¥ï¼ˆå¦‚åŠ¨æ€æ°´å°ã€åˆ†å±‚æ°´å°ï¼‰
- [ ] å¼€å‘æ¡Œé¢å®¢æˆ·ç«¯ç‰ˆæœ¬

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ LICENSE æ–‡ä»¶ 
